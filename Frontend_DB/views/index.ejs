<!DOCTYPE html>
<html>
<head>
  <title>WebSocket with EJS</title>
  <style>

    .center{

      margin: auto;
      width: 50%;
      padding: 10px;




    }
  </style>



</head>
<body>
  <div class="center">


    
  <div class="center">
  <h1><u>Dashboard for monitoring</u></h1>
    <br>
    <div class="center">

    <h3>Condition</h3>

    <div id="message"><%= message %></div>
  </div>

    <br>
    <br>
    <div class="center">

    <h3>Alarm Config</h3>
    <br>
    <br>



    </div>

  </div>
    <form method="POST" id="myForm">

  <% database_json.forEach(DATA => { %>
    <form method="POST">
         <label for="id">ID:</label>
      <input type="text" name="id" id="id" value="<%= DATA.id %>">
      <br>
      <label for="address_0">Address 0:</label>
      <input type="text" name="address_0" id="address_0" value="<%= DATA.address_0 %>">
      <br>
      <label for="address_1">Address 1:</label>
      <input type="text" name="address_1" id="address_1" value="<%= DATA.address_1 %>">
      <br>
      <label for="address_2">Address 2:</label>
      <input type="text" name="address_2" id="address_2" value="<%= DATA.address_2 %>">
      <br>
      <label for="address_3">Address 3:</label>
      <input type="text" name="address_3" id="address_3" value="<%= DATA.address_3 %>">
      <br>
      <label for="address_4">Address 4:</label>
      <input type="text" name="address_4" id="address_4" value="<%= DATA.address_4 %>">
      <br>
      <label for="address_5">Address 5:</label>
      <input type="text" name="address_5" id="address_5" value="<%= DATA.address_5 %>">
      <br>
      <label for="address_6">Address 6:</label>
      <input type="text" name="address_6" id="address_6" value="<%= DATA.address_6 %>">
      <br>
      <!-- Add more address fields as needed -->
      <!-- ... -->
      <label for="address_15">Address 15:</label>
      <input type="text" name="address_15" id="address_15" value="<%= DATA.address_15 %>">
      <br>
      <button type="button" onclick="submitForm()">Submit</button>
    </form>
  <% }); %>



    </form>


  </div>

  <script>
    const socket = new WebSocket('<%= websocketUrl %>');

    socket.onopen = () => {
      console.log('WebSocket client connected');
    };

    socket.onmessage = (event) => {
      console.log('Received message from server:', event.data);
      document.getElementById('message').textContent = event.data;
    };

    socket.onmessage = (event) => {
      console.log('Received message from server:', event.data);
      document.getElementById('message').textContent = event.data;
    };

    socket.onclose = () => {
      console.log('WebSocket connection closed');
      alert('WebSocket connection closed, Please refresh browser to reconnect otherwise the PLC is not under monitor realtime');
          // Access the element by ID
    const ErrorDisconnect = document.getElementById('message');

    // Modify the element
    ErrorDisconnect.textContent = 'WebSocket connection closed, Please refresh browser to reconnect otherwise the PLC is not under monitor realtime';
    ErrorDisconnect.style.color = 'red';
    };




    function submitForm() {
        const form = document.getElementById('myForm');
        console.log(form);
        const formData = new FormData(form);
        console.log(formData);


          // Access individual form fields and their values
  formData.forEach((value, key) => {
    console.log(`${key}: ${value}`);
  });


        fetch('/', {
          method: 'PUT',
          body: formData
        })
          .then(response => response.json())
          .then(data => {
            console.log(data);
            // Handle the response as needed
          })
          .catch(error => {
            console.error('Error:', error);
            // Handle any errors that occur during the request
          });
      }
  </script>
</body>
</html>
